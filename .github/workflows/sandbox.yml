name: Sandbox Runner

on:
  repository_dispatch:
    types: [run-sandbox]

jobs:
  sandbox:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Print payload
        run: echo '${{ toJson(github.event.client_payload) }}'

      - name: Run Docker sandbox
        run: |
          docker --version
          docker run --rm alpine echo "Sandbox executed successfully"

      - name: Send result back to backend
        run: |
          curl -X POST https://autonomous-ci-cd-healing-agent.onrender.com/api/sandbox/callback \
            -H "Content-Type: application/json" \
            -d '{
              "runId": "${{ github.event.client_payload.runId }}",
              "status": "completed",
              "message": "Docker executed successfully"
            }'
